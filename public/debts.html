<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link href="css/css.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="js/juqery-1.10.2.js"></script>
    <script type="text/javascript" src="js/jquery_ujs.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>

</head>
<body>
<style type="text/css">
.bkwhite .top{background: none;}
.touzixmgb{background:white;}
.wylclist .lefter{width:856px;background:white;border-radius: 5px;}
</style>
<div class="header">
   <div class="headerson">
      <div class="left">
         <span>欢迎致电：</span><span class="da phone400"></span><span class='serve_time'></span>
         <a href="http://www.weibo.com/yataiyangguang" class="qqlog posa" target='_blank'></a>
         <a href="http://t.qq.com/yataitouzi" class="qqlog posb" target='_blank'></a>
      </div>
      <div class="right">
         <span id='hello' onclick="javascript:window.location.href='/account/users'">您好： <span id='username'></span>
          <div class="xllists">
             <a href="/account/users">我的账户</a>
             <a href="/account/recharge">我要充值</a>
             <a href="/account/withdraws/new">我要提现</a>
             <a href="/account/transactions">资金管理</a>
             <a href="/account/invests">理财管理</a>
             <a rel="nofollow" data-method="delete" href="/users/sign_out">退出</a>
          </div>
        </span>
         <a href="/users/sign_in" class="zc sign">登陆</a>&nbsp;
         <a href="/users/sign_up" class="zc sign">注册</a>
      </div>
   </div>
</div>
<div class="neck">
   <div class="neckson">
      <div class="logo" onclick="javascript:window.location.href='/'">
         <img src="image/logo.jpg" width="248" height="87" />
      </div>
      <div class="navright">
         <a href="/loans">我要理财</a>
         <a href="/debts">债权转让</a>
         <a href="/loan_applications/new">我要融资</a>
         <a href="/news">亚太资讯</a>
         <a href="/aboutus">关于我们</a>
      </div>
   </div>
</div>
<div class="bod">
    <div class="erjinav">
        <div class="erjinavson">
            <a href="#">债权转让</a>><a href="#">债权转让列表</a>
        </div>
    </div>
    <div class="bodson bkwhite">
        <div class="top">
            <div class="yaolinetab">
                <div>
                    <div>项目名称</div>
                    <div>年利率</div>
                    <div>转让金额</div>
                    <div>期限</div>
                    <div>还款方式</div>
                </div>
            </div>
            <div id="itemContainer">
            </div>
            <div class="wylclist" id="holder">
            </div>
        </div>


        <div id="item-tmp" style="display: none;">
            <div class="wylclist">
                <div class="lefter">
                    <span class="yikuan dazi title"></span>
                    <span class="erkuan dazi juse interest"></span>
                    <span class="paddinger lanser amount"></span>
                    <span class="paddinger lanser months"></span>
                    <span class="paddinger lanser a100"></span>
                </div>

                <a class="righter" href=""></a>
            </div>
        </div>
    </div>
    <div class="footers">
        <div class="fonterson">
            <div class="left">
                <div class="zhzi">客服热线</div>
                <div class="dazi lan phone400"></div>
                <div class="xzi serve_time"></div>
                <div class="zhzi">官方QQ群</div>
                <div class="dazi lan qq_group"></div>
            </div>
            <div class="center">
                <img src="image/dengfoot.jpg"/>
                <img src="image/xingfoot.jpg"/>
                <img src="image/lianfoot.jpg"/>
            </div>
            <img src="image/qrcode.png"/>
        </div>
    </div>
    <div class="foot">
        <div class="top">
            <a href="news" target="_blank">关于我们</a>
            <a href="#" target="_blank">理财问答</a>
            <a href="#" target="_blank">法律声明</a>
            <a href="#" target="_blank">联系我们</a>
            <a href="#" target="_blank">加入我们</a>
            <a href="#" target="_blank">友情链接</a>
            <a href="#" target="_blank">我要融资</a>
            <a href="#" target="_blank">收益计算器</a>
            <a href="#" target="_blank">合同托管查询</a>
        </div>
        <div class="bottom">
            <div class="bottomson">
                <a href="#" target="_blank"><img src="image/youqinglj.jpg"/></a>
                <a href="#" target="_blank"><img src="image/youqinglj.jpg"/></a>
                <a href="#" target="_blank"><img src="image/youqinglj.jpg"/></a>
            </div>
        </div>
    </div>
</div>
<div class="modals">
    <div class="modalsson">
        <div class="title">头像设置</div>
        <form method="" action="#" enctype="multipart/form-data">
            <div class="fileups"><input type="file" class="fileup"/>

                <div class="hqyzmer hqyzmers">选择文件</div>
                <span>您可以上传jpg,png,gif图片，上传最大4M。</span></div>
            <div class="hqyzmer hqyzreset">取消</div>
            <input type="submit" class="hqyzm"/>
        </form>
    </div>
</div>
<script type="text/javascript" src="js/jqueryuser.js"></script>
<script type="text/javascript">
function bindClick() {

    $("#holder a").on('click', function () {
        var page_number = $(this).attr('page');
//          传递已选筛选项+点击的页码数至search_json这个action
        json = array_to_json(page_number);
        search_json(json);
//        return false;
    });
}
$(document).ready(function () {
    //        分页AJAX实现


    info_json_string = "\"" + 'page' + "\":\"" + 1 + "\",";
    info_json_json = jsonString(info_json_string)
    info_json(info_json_json);

    // 说明：获取点选元素的父元素，用于清空原来的筛选,为新筛选项增加CLASS
    // 创建时间：2015年4有15日
    // 创建人：周凯
    var items = $(".invests_filter_items li span.condition");
    var jsonUserInfo = ''
    items.each(function (i) {
        var t = $(this);
        t.click(function () {
            current_change = t.attr('class');
            if (current_change != 'jhkuai current_change') {
                t.toggleClass("jhkuai current_change");
                t.siblings().removeClass('jhkuai current_change');

                json = array_to_json(1);
                search_json(json);
            }
//
        });
    });


})
function array_to_json(page_number) {
    var jsonUserInfo = ''
    $(".current_change").each(function (index, data) {
        cl = $(data).parent().attr('class').toString()
        console.info(cl);
        name = $(data).attr('name')
        jsonUserInfo += "\"" + cl + "\":\"" + name + "\",";
    })
    jsonUserInfo += "\"" + 'page' + "\":\"" + page_number + "\",";

    var json = jsonString(jsonUserInfo)

    return json;
}

function jsonString(jsonUserInfo) {
    var jsonString = "{" + jsonUserInfo.substring(0, jsonUserInfo.length - 1) + "}";
    var json = $.parseJSON(jsonString)
    return json;
}

function set_page_number(current_page, total_pages) {
    current_page = Number(current_page);
    total_pages = Number(total_pages);
    var str = "";
    if (total_pages > 1) {
        if (current_page != 1) {
            prev_page = Number(current_page) - 1;
            str += '<a class="jp-previous jp-disabled" name="prev" page =' + prev_page + '>上一页</a>';
        }
        if (total_pages >= 6) {
            if (current_page <= 5) {
                for (var i = 1; i <= 5; i++) {
                    if (current_page == i) {
                        str += "<a class='jp-current' page='" + i + "' href='javascript:void(0);'>" + i + "</a>";
                    } else {
                        str += "<a href = 'javascript:void(0);' page='" + i + "'>" + i + "</a>";
                    }
                }
                str += '...';
                next_page = Number(current_page) + 1;
            } else if (current_page > 5 && ((total_pages - current_page) > 3)) {
                str += "<a href = 'javascript:void(0);' page='" + 1 + "'>" + 1 + "</a>";
                str += "<a href = 'javascript:void(0);' page='" + 2 + "'>" + 2 + "</a>" + '...';

                for (var i = (current_page - 1); i <= (current_page + 1); i++) {
                    console.log(current_page);
                    if (current_page == i) {
                        str += "<a class='jp-current' page='" + i + "' href='javascript:void(0);'>" + i + "</a>";
                    } else {
                        str += "<a href = 'javascript:void(0);' page='" + i + "'>" + i + "</a>";
                    }
                }
                str += '...';
            } else {
                str += "<a href = 'javascript:void(0);' page='" + 1 + "'>" + 1 + "</a>";
                str += "<a href = 'javascript:void(0);' page='" + 2 + "'>" + 2 + "</a>" + '...';
                for (var i = (current_page - 1); i <= (current_page + 1); i++) {
                    if (current_page == i) {
                        str += "<a class='jp-current' page='" + i + "' href='javascript:void(0);'>" + i + "</a>";
                    } else {
                        str += "<a href = 'javascript:void(0);' page='" + i + "'>" + i + "</a>";
                    }
                }
            }

            if (current_page < total_pages) {

                next_page = Number(current_page) + 1;
                str += "<a href = 'javascript:void(0);' class='jp-next' name='next' page=" + next_page + ">下一页</a>";
                if (total_pages >= 5) {
                    str += '<a href = \'javascript:void(0);\' class="jp-last" name="last" page=' + total_pages + '>尾页</a>';
                }
            }

        } else {
            for (var i = 1; i <= total_pages; i++) {
                if (current_page == i) {
                    str += "<a class='jp-current' page='" + i + "' href='javascript:void(0);'>" + i + "</a>";
                } else {
                    str += "<a href = 'javascript:void(0);' page='" + i + "'>" + i + "</a>";
                }
            }
            if (current_page < total_pages) {
                next_page = Number(current_page) + 1;
                str += "<a href = 'javascript:void(0);' class='jp-next' name='next' page=" + next_page + ">下一页</a>";
            }
        }


    }
    return str;
}

function search_json(json) {
    $.ajax({
        url: "/debts/debt_json",
        data: json,
        dataType: 'json',
        success: function (data) {
            total_pages = data.total_pages;
            current_page = data.current_page;
            $('#holder').empty();
            str = set_page_number(current_page, total_pages);
            $("#holder").html(str);
            $('#itemContainer').empty();
            console.info(data.loans)
            html_show(data)
            if (Number(total_pages) >= Number(current_page)) {
                bindClick();
            }
//
//            }
        }
    });
}
;
function info_json(page) {
    $.ajax({
        url: "/debts/debt_json",
        data: page,
        dataType: 'json',
        success: function (data) {
            $('#holder').empty();
            $('#holder').attr('name', '');
//                组织index页面分页显示
            total_pages = Number(data.total_pages);
            current_page = Number(data.current_page);
            str = set_page_number(current_page, total_pages);
            $("#holder").attr('name', 'info_json').append(str);

//                组织index页面总数据

            html_show(data);
            bindClick();
        }
    });
}
;

function html_show(data) {
    for (var item in data.loans) {
        for_sale_amount = Number(data.loans[item].for_sale_amount);
        if (for_sale_amount > 10000){
            for_sale_amount = Math.floor((Number(for_sale_amount)/10000))+'万元'
        }else{
            for_sale_amount = for_sale_amount.toFixed(2)+'元'
        }



        $('#item-tmp .wylclist .title').html('<a class="dimgray" href="/show_debts?id=' + data.loans[item].id + '"target="_blank" title="' + data.loans[item].id + '">' + data.loans[item].title + '</a>');

        $('#item-tmp .wylclist .interest').text(data.loans[item].interest + '%');
        $('#item-tmp .wylclist .amount').text(for_sale_amount);
        $('#item-tmp .wylclist .months').text(data.loans[item].invest_month + '个月');
        $('#item-tmp .wylclist .righter').removeClass('lanser');
        $('#item-tmp .wylclist .righter').addClass('juhong');
        $('#item-tmp .wylclist .righter').attr('href', "/show_debts?id=" + data.loans[item].id);

        $('#item-tmp .wylclist .righter').text('去投标');
        if (data.loans[item].repay_style == 'equal') {
            $('#item-tmp .wylclist .a100').text('等额本息');
        }
        if (data.loans[item].repay_style == 'interest_only') {
            $('#item-tmp .wylclist .a100').text('先息后本');
        }
        if (data.loans[item].repay_style == 'at_due') {
            $('#item-tmp .wylclist .a100').text('到期还本息');
        }
        $('#itemContainer').append($('#item-tmp ').html());
    }
}

function formatNum(str) {
    var newStr = "";
    var count = 0;

    if (str.indexOf(".") == -1) {
        for (var i = str.length - 1; i >= 0; i--) {
            if (count % 3 == 0 && count != 0) {
                newStr = str.charAt(i) + "," + newStr;
            } else {
                newStr = str.charAt(i) + newStr;
            }
            count++;
        }
        str = newStr + ".00"; //自动补小数点后两位
        console.log(str)
    }
    else {
        for (var i = str.indexOf(".") - 1; i >= 0; i--) {
            if (count % 3 == 0 && count != 0) {
                newStr = str.charAt(i) + "," + newStr;
            } else {
                newStr = str.charAt(i) + newStr; //逐个字符相接起来
            }
            count++;
        }
        str = newStr + (str + "00").substr((str + "00").indexOf("."), 3);
        console.log(str)
    }
    return str;
}


function xinspect(o, i) {
    if (typeof i == 'undefined')i = '';
    if (i.length > 50)return '[MAX ITERATIONS]';
    var r = [];
    for (var p in o) {
        var t = typeof o[p];
        r.push(i + '"' + p + '" (' + t + ') => ' + (t == 'object' ? 'object:' + xinspect(o[p], i + '  ') : o[p] + ''));
    }
    return r.join(i + '\n');
}

</script>
</body>
</html>
